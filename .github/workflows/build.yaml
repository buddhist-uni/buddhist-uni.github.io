name: Build the site
on:
  workflow_dispatch:
  push:
     branches:
       - master
jobs:
   Jekyll:
     runs-on: ubuntu-latest
     steps:
         - name: Checkout the Code
           uses: actions/checkout@v2
           with:
             fetch-depth: 0
         - name: git log
           run: |
            cd $GITHUB_WORKSPACE
            date --date="@$(git log -n 1 --format=%ct -- about.md)"
            git --git-dir=.git log --name-only --date=unix --pretty=%%these-files-modified-at:%ct -n 6
         - name: Normalize Unicode in the Previous Commit
           uses: buddhist-uni/normalized-unicode-action@v0.2
         - name: Restore Previous Gemfiles
           uses: actions/cache@v2
           with:
             path: ${{ github.workspace }}/vendor
             key: ${{ runner.os }}-vendor-00-${{ hashFiles('**/Gemfile.lock') }}
             restore-keys: |
                ${{ runner.os }}-vendor-00-
         - name: Install Jekyll and Build the Site
           uses: helaili/jekyll-action@v2.3
           with:
             token: ${{ secrets.BUILD_ACTION_TOKEN }}
             target_branch: prod

