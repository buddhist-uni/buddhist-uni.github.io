---
title: "Content Tests"
---

A series of tests checking the integrity of the _content data


| Test Name | Status |  Notes |
|-----------|--------|--------|
| Count     | {% if site.content.size > 100 %}Pass ✅{% else %}FAIL ❌{% endif %}  | With {{ site.content.size }} items in the library. |
| Excessive Authors | {% assign ea = site.content | where_exp: "c", "c.authors.size > 5" %}{% if ea.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  {% assign cout = '' | split: '' %}{% for c in ea %}{% assign cout = cout | push: c.path %}{% endfor %}Found {{ ea.size }} works with more than 5 authors{% if ea.size > 0 %}:{% else %}.{% endif %} {{ cout | array_to_sentence_string }}
| External URLs are Unique | {% assign ac = site.content | where_exp: "c", "c.external_url" %}{% assign seen = "" | split: "" %}{% assign dupes = "" | split: "" %}{% for c in ac %}{% if seen contains c.external_url %}{% unless dupes contains c.external_url %}{% assign dupes = dupes | push: c.external_url %}{% endunless %}{% else %}{% assign seen = seen | push: c.external_url %}{% endif %}{% endfor %}{% if dupes.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  {% if dupes.size > 0 %}Found these duplicate URLs: `{{ dupes | join: " " }}`{% else %}No duplicate URLs found.{% endif %} 
| External URLs are URLs | {% assign ac = site.content | where_exp: "c", "c.external_url" %}{% assign fails = "" | split: "" %}{% for c in ac %}{% unless c.external_url contains "http" %}{% assign fails = fails | push: c %}{% endunless %}{% endfor %}{% if fails.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  {% if fails.size > 0 %}Found these bad URLs: {% for c in fails %}[{{ c.title | split: ":" | first }}]({{ c.url }}) {% endfor %}{% else %}No URLs missing http.{% endif %} 
| Drive Links are Unique | {% assign ac = site.content | where_exp: "c", "c.drive_links" %}{% assign seen = "" | split: "" %}{% assign dupes = "" | split: "" %}{% for c in ac %}{% for fd in c.drive_links %}{% unless fd contains "https://drive.google.com/" %}{% continue %}{% endunless %}{% assign d = fd | split: "?" | first %}{% if seen contains d %}{% unless dupes contains d %}{% assign dupes = dupes | push: d %}{% endunless %}{% else %}{% assign seen = seen | push: d %}{% endif %}{% endfor %}{% endfor %}{% if dupes.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  {% if dupes.size > 0 %}Found these duplicate links: `{{ dupes | join: " " }}`{% else %}No duplicate links found.{% endif %}
| Course in tags | {% assign failures = site.content | where_exp: "c", "c.tags contains c.course" %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  | There are {{ failures.size }} pieces with the course in the tags{% if failures.size > 0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
| Sane file_links | {% assign hostedcontent = site.content | where_exp: "c", "c.file_links.size > 0" %}{% assign fs = '' | split: '' %}{% for c in hostedcontent %}{% for l in c.file_links %}{% assign s = l | split: "/" %}{% if site.data.content.valid_buckets contains s[0] %}{% if s contains "blob" %}{% assign fs = fs | push: c %}{% endif %}{% else %}{% assign fs = fs | push: c %}{% endif %}{% endfor %}{% endfor %}{% if fs.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  {% assign count = hostedcontent.size | minus: fs.size %}{% if count > 0 %}There are {{ count }} sane links{% endif %}{% if fs.size > 0 %}The {{ fs.size }} pieces with bad buckets are: {% for c in fs %}[{{ c.title | split: ":" | first }}]({{ c.url }}) {% endfor %}{% endif %}
| file_links match formats | {% assign fs = '' | split: '' %}{% for c in hostedcontent %}{% for l in c.file_links %}{% assign ee = l | split: "." | last | downcase %}{% unless ee == c.formats[forloop.index0] or c.formats[forloop.index0] == 'mp3s' %}{% assign fs = fs | push: c %}{% endunless %}{% endfor %}{% endfor %}{% if fs.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  {% assign count = hostedcontent.size | minus: fs.size %}{% if count > 0 %}There are {{ count }} sane formats.{% endif %}{% if fs.size > 0 %} The {{ fs.size }} pieces with bad formats are: {% for c in fs %}[{{ c.title | split: ":" | first }}]({{ c.url }}) {% endfor %}{% endif %}
| Negative Pages | {% assign fails = '' | split: '' %}{% for cont in site.content %}{% unless cont.pages %}{% continue %}{% endunless %}{% if cont.pages contains "--" %}{% assign ps = cont.pages | split: "--" %}{% assign ps = 1 | plus: ps[1] | minus: ps[0] %}{% if ps < 1 or ps != cont.page_count %}{% assign fails = fails | push: cont %}{% endif %}{% else %}{% if cont.pages < 1 %}{% assign fails = fails | push: cont %}{% endif %}{% endif %}{% endfor %}{% if fails.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | Found {{ fails.size }} with negative pages{% if fails.size > 0 %}: {{ fails | map: "path" | array_to_sentence_string }}{% endif %}
| Missing Author Pages | {% assign expect = '' | split: '' %}{% for cont in site.content %}{% for auth in cont.authors %}{% unless auth contains " " %}{% unless expect contains auth %}{% assign expect = expect | push: auth %}{% endunless %}{% endunless %}{% endfor %}{% endfor %}{% assign grouped = expect | group_by_exp: "auth", "site.authors | where: 'slug', auth | size" %}{% for group in grouped %}{% if group.name == 0 %}{% assign failed = group.items %}{% else %}{% assign found = group.items %}{% endif %}{% endfor %}{% if expect.size == found.size %}Pass ✅{% else %}FAIL ❌{% endif %}  |  Of the {{ expect.size }} authors cited, {{ found.size }} of them are in the database. {% if failed.size > 0 %}Failed to find author pages for: {{ failed | array_to_sentence_string }}{% endif %}
| Content Missing an Author | {% assign fails = '' | split: '' %}{% for cont in site.content %}{% unless cont.slug contains "_" %}{% continue  %}{% endunless %}{% unless cont.authors.size >= 1 or cont.translator or cont.editor or cont.reader or cont.journal == "tricycle" %}{% assign fails = fails | push: cont %}{% endunless %}{% endfor %}{% if fails.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | Found {{ fails.size }} works without authors{% if fails.size > 0 %}: {{ fails | map: "url" | array_to_sentence_string }}{% endif %}
| Unlinked Authors | {% assign authors = site.authors | map: "title" %}{% assign dupes = '' | split: '' %}{% for cont in site.content %}{% for auth in cont.authors %}{% if authors contains auth %}{% assign dupes = dupes | push: cont %}{% break %}{% endif %}{% endfor %}{% endfor %}{% if dupes.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | Found {{ dupes.size }} works with unlinked authors{% if dupes.size > 0 %}: {{ dupes | map: "url" | array_to_sentence_string }}{% endif %}
| Dangling Authors | {% assign authors = site.authors | map: "slug" %}{% for auth in found %}{% assign authors = authors | where_exp: "a", "a != auth" %}{% endfor %}{% assign unfound = '' | split: '' %}{% for auth in authors %}{% assign c = site.content | where: "translator", auth | size %}{% if c > 0 %}{% continue %}{% endif %}{% assign c = site.content | where: "editor", auth | size %}{% if c > 0 %}{% continue %}{% endif %}{% assign c = site.content | where: "reader", auth | size %}{% if c == 0 %}{% assign unfound = unfound | push: auth %}{% endif %}{% endfor %}{% if unfound.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %}  |  There are {{ unfound.size }} authors with no works attributed to them{% if unfound.size == 0 %}.{% else %}: {{ unfound | array_to_sentence_string }}.{% endif %}
| Content unexpectedly missing links | {% assign failures = site.content | where_exp: "c", "c.external_url == nil" | where_exp: "c", "c.drive_links == nil" | where_exp: "c", "c.source_url == nil" | where_exp: "c", "c.file_links == nil" | where_exp: "c", "c.category != 'monographs'" | where_exp: "c", "c.status != 'rejected'"  | where_exp: "c", "c.slug != 'historical-dictionary-of-chan_wang-youru'" | where_exp: "c", "c.subcat != 'film'" %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | There are {{ failures.size }} missing links{% if failures.size >0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
| Films have video files | {% assign failures = site.content | where: "subcat", "film" | where_exp: "c", "c.drive_links[0]" | where_exp: "c", "c.formats[0] == 'mp3'" %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | There are {{ failures.size }} films with mp3s{% if failures.size > 0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
| https error | {% assign ec = site.content | where_exp: "c", "c.external_url contains 'http://'" %}{% assign ed = "" | split: "" %}{% for c in ec %}{% unless c.external_url contains "https://" %}{% assign ed = ed | push: c %}{% endunless %}{% endfor %}{% assign failures = ed | where_exp: "c", "c.external_url contains '.pdf'" %}{% assign ec = ed | where_exp: "c", "c.external_url contains 'download'" %}{% assign failures = failures | concat: ec %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | There are {{ failures.size }} links that need to be https{% if failures.size >0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
| Content missing year | {% assign failures = site.content | where_exp: "c", "c.year == nil" %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | There are {{ failures.size }} missing years{% if failures.size >0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
| Invalid months | {% assign failures = "" | split: "" %}{% for cont in site.content %}{% if cont.month %}{% unless site.data.bibtex.months contains cont.month %}{% assign failures = failures | push: cont.path %}{% endunless %}{% endif %}{% endfor %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | {{ failures.size }} bad months found{% if failures.size >0 %}: {{ failures | array_to_sentence_string }}{% endif %}
| Content missing from its course | {% assign failures = "" | split: "" %}{% for course in site.courses %}{% if course.layout == "multipartcourse" %}{% continue %}{% endif %} {% assign allcc = site.content | where: "course", course.slug | where_exp: "c", "c.category != 'canon'" | where_exp: "c", "c.series != 'mn-study_bodhi'" %}{% for content in allcc %}{% unless course.content contains content.slug %}{% assign failures = failures | push: content %}{% endunless %}{% endfor %}{% endfor %}{% if failures.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | There are {{ failures.size }} found{% if failures.size >0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
| Series content missing a number | {% assign failures = site.content | where_exp: "c", "c.number == nil" | where_exp: "c", "c.series != nil and c.series != 'annotated-suttas_suddhaso'" %}{% if failures.size == 0%}Pass ✅{% else %}FAIL ❌{% endif %} | There are {{ failures.size }} found{% if failures.size >0 %}: {{ failures | map: "slug" | array_to_sentence_string }}{% endif %}.
{% if site.partial_build %}| Partial build filters useless stuff | {% assign torem = "" | split: "" %}{% assign courseslugs = site.courses | map: "slug" %}{% assign manualslugs = "nature,west,nuns,view,thought,society,inner,wider" | split: "," %}{% assign tagslugs = site.tags | where: "status", "published" | map: "slug" %}{% assign courseslugs = tagslugs | concat: courseslugs | concat: manualslugs %}{% for c in site.content %}{% if c.course and courseslugs contains c.course %}{% continue %}{% endif %}{% assign f = "go" %}{% assign slug = c.path | split: "/" | last | split: "." | pop | join: "." %}{% for p in site.documents %}{% if p.content contains slug or p.content contains c.slug  %}{% assign f = "pass" %}{% break %}{% endif %}{% endfor %}{% if f == "pass" %}{% continue %}{% endif %}{% assign torem = torem | push: c %}{% endfor %}{% if torem.size == 0 %}Pass ✅{% else %}FAIL ❌{% endif %} | Found {{ torem.size }} useless pieces{% if torem.size > 0 %} (listed below).{% endif %}
| Partial build doesn't filter useful stuff | {% assign toadd = '' | split: '' %}{% for path in site.exclude %}{% unless path contains "_content/" %}{% continue %}{% endunless %}{% assign slug = path | split: "/" | last | split: "." | first %}{% for p in site.documents %}{% if p.content contains slug %}{% assign toadd = toadd | push: path %}{% break %}{% endif %}{% endfor %}{% endfor %}{% if toadd.size == 0 %}Pass ✅ | Found no useful pieces excluded. {% else %}FAIL ❌ | Found {{ toadd.size }} useful pieces to add (see below). {% endif %}

{% if torem.size > 0 or toadd.size > 0 %}
`_quick_build.yml` changes:

```yml
add_to_exclude:
{% for c in torem %}    - {{ c.path }}
{% endfor %}
remove_from_exclude:
{% for c in toadd %}    - {{ c }}
{% endfor %}```
{% endif %}{% endif %}

