---
layout: default
---
<article class="content-perma">

  <header class="post-header">
    {% assign title = page.title | markdownify | remove: '<p>' | remove: '</p>' | split: ": " %}
    <h1 class="post-title">{{ title | first }}</h1>
    {% if title.size > 1 %}<h2 class="post-subtitle">{{ title | shift | join: ": " }}</h2>{% endif %}
    {% if page.authors.size > 0 %}<h2 class="author">
        By {% include content_authors_string.html content=page hide_reader=true link=true %}
    </h2>{% endif %}
    {% if page.reader %}
    {% assign reader = site.authors | where: "slug", page.reader | first %}
    <h2 class="author">Read by {% if reader %}<a href="{{ reader.url }}">{{ reader.title }}</a>{% else %}{{ page.reader }}{% endif %}</h2>
    {% endif %}
    {% assign translator = site.authors | where: "slug", page.translator | first %}
    {% if page.translator %}
    <h3 class="translator">Translated by {% if translator %}<a href="{{ translator.url }}">{{ translator.title }}</a>{% else %}{{ page.translator }}{% endif %}</h3>
    {% endif %}
        <p class="content_links">
        {% if page.external_url or page.drive_links.size > 0 %}
        {% assign value = page.base_value %}{% if page.status=="featured" %}{% assign value = value | times: site.data.ga.featured_value_multiplier %}{% endif %}
        {% if page.external_url %}Find it <a target="_blank" ga-event-value="{{ value }}" href="{{ page.external_url }}">online here</a>{% unless page.drive_links.size > 0 or page.source_url %}.{% endunless %}{% endif %}
        {% if page.drive_links.size > 0 %}
            {% assign format_links = '' | split: '' %}
            {% for link in page.drive_links %}
                {% assign i = forloop.index | minus: 1 %}
                {% capture format_link %}<a target="_blank" ga-event-value="{{ value }}" ga-event-label="drive.google.com/{{ page.path | split: '.' | first }}.{{ page.formats[i] }}" href={{ link }}>{{ page.formats[i] }}</a>{% endcapture %}
                {% assign format_links = format_links | push: format_link %}
            {% endfor %}
            {% if page.external_url %}or get{% else %}Get{% endif %} the {{ format_links | array_to_sentence_string: "or" }} on Google Drive{% unless page.source_url %}.{% endunless %}{% endif %}
        {% endif %}
        {% if page.source_url %}
        adapted from <a href="{{ page.source_url }}" ga-event-value="{{ value }}" target="_blank">this original</a>.
    {% endif %}
        </p>

 </header>
  <div class="post-content">
        {{ content }}
  </div>

  <footer>
    {% if page.series %}{% assign series = site.series | where: "slug", page.series | first %}{% endif %}
    {% if page.journal %}{% assign journal = site.journals | where: "slug", page.journal | first %}{% endif %}
    {% if page.publisher %}{% assign publisher = site.publishers | where: "slug", page.publisher | first %}{% endif %}
    {% if page.editor %}{% assign editor = site.authors | where: "slug", page.editor | first %}{% endif %}
    {% if page.year or page.publisher or page.booktitle or page.journal or series %}
        <p><i>Published{% if page.year %} in {{ page.year }}{% endif %}{% if page.journal %} in {% if journal %}<a href="{{ journal.url }}">{{ journal.title }}</a>{% else %}{{ page.journal }}{% endif %}{% endif %}{% if page.booktitle %} in “{{ page.booktitle }}”{% endif %}{% if page.editor %} ({% if editor %}<a href="{{ editor.url }}">{{ editor.title }}</a>{% else %}{{ page.editor | split: " and " | array_to_sentence_string }}{% endif %} ed.){% endif %}{% if page.publisher %} by {% if publisher %}<a href="{{ publisher.url }}">{{ publisher.title }}</a>{% else %}{{ page.publisher }}{% endif %}{% if page.address or publisher.address %}, {{ page.address | default: publisher.address }}{% endif %}{% endif %}{% if series %} {% if page.number %}as{% else %}in{% endif %} <a href="{{ series.url }}">{{ series.title }}</a>{% if page.number %} number {{ page.number }}{% endif %}{% endif %}.</i></p>
    {% endif %}

    {% assign tagslugs = '' | split: '' %}
    {% if page.course %}
        {% assign tagslugs = tagslugs | push: page.course %}
    {% endif %}
    {% if page.tags.size > 0 %}
        {% assign tagslugs = tagslugs | concat: page.tags %}
    {% endif %}
    {% assign tags = '' | split: '' %}
    {% for t in tagslugs %}
        {% assign tag = site.tags | where: "slug", t | first %}
        {% if tag %}
            {% capture taglink %}<a href="{{ tag.url }}">{{ tag.title }}</a>{% endcapture %}
            {% assign tags = tags | push: taglink %}
        {% endif %}
    {% endfor %}

    {% if tags.size > 0 %}<p class="content_tags">Tags: {{ tags | array_to_sentence_string }}.
    {% if page.course %}
        {% assign course = site.courses | where: "slug", page.course | first %}
        {% if course %}
            <i>Featured in the course, "<a href="{{ course.url }}"><i class="{{ course.icon }}"></i> {{ course.title }}</a>."</i>
        {% endif %}
    {% endif %}
    </p>
    {% endif %}
    
    {% assign possible = tagslugs.size | plus: page.authors.size %}
    {% if possible >= site.data.content.min_similarity_score %}
       {% assign similars = '' | split: '' %}
       {% assign target_similarity = site.data.content.min_similarity_score %}
       {% assign nears = '' | split: '' %}
       {% assign nearly = target_similarity | minus: 1 %}
       {% for content in site.content %}
        {% if content.status == "rejected" or content.path == page.path %}{% continue %}{% endif %}
        {% assign possible = content.tags.size | plus: content.authors.size %}
        {% if content.course %}
          {% assign possible = possible | plus: 1 %}
        {% endif %}
        {% if possible < nearly %}{% continue %}{% endif %}
        {% if tagslugs contains content.course %}
          {% assign score = 1 %}
        {% else %}
          {% assign score = 0 %}
        {% endif %}
        {% assign authscore = content.authors | where_exp: "i", "page.authors contains i" | size %}
        {% assign tagscore = content.tags | where_exp: "i", "tagslugs contains i" | size %}
        {% assign score = score | plus:  authscore | plus: tagscore %}
        {% if score == target_similarity %}
          {% assign similars = similars | push: content %}
        {% elsif score == nearly %}
          {% assign nears = nears | push: content %}
        {% elsif score > target_similarity %}
          {% assign nearly = score | minus: 1 %}
          {% if target_similarity == nearly %}
            {% assign nears = similars %}
          {% else %}
            {% assign nears = '' | split: '' %}
          {% endif %}
          {% assign similars = '' | split: '' | push: content %}
          {% assign target_similarity = score %}
        {% endif %}
       {% endfor %}
       {% if similars.size < site.data.content.min_similars %}
         {% assign similars = similars | concat: nears %}
       {% endif %}
       {% if similars.size > site.data.content.max_similars %}
         {% assign category = page.category %}
         {% capture filter %}c.path contains '/{{ category }}/'{% endcapture %}
         {% assign filtered = similars | where_exp: "c", filter %}
         {% if filtered.size > 0 %}
           {% assign similars = filtered %}
         {% else %}
          {% capture cat_filter %}c.path == "content/{{ category }}.md"{% endcapture %}
          {% assign category = site.pages | where_exp: "c", cat_filter | first %}
          {% for cat in category.similars %}
            {% capture filter %}c.path contains '/{{ cat }}/'{% endcapture %}
            {% assign f = similars | where_exp: "c", filter %}
            {% assign filtered = filtered | concat: f %}
          {% endfor %}
          {% if filtered.size > 0 %}
            {% assign similars = filtered %}
          {% endif %}
         {% endif %}
       {% endif %}
       {% if similars.size > site.data.content.max_similars %}
         {% assign filtered = similars | where: "status", "featured" %}
         {% if filtered.size > 0 %}{% assign similars = filtered %}{% endif %}
       {% endif %}
       {% if similars.size > 0 %}<div class="similar_content_footer">
         <p>You may also be interested in:</p>
         <ul>{% for c in similars %}
           <li>{% include simple_content_title.html content=c %}</li>
         {% endfor %}</ul>
       </div>{% endif %}
    {% endif %}
  </footer>

</article>
